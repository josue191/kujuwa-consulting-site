
/**
 * @file Firestore Security Rules for Kujuwa Consulting.
 *
 * Core Philosophy:
 * This ruleset provides secure access to Kujuwa Consulting's Firestore database,
 * enforcing strict data segregation and role-based access control.
 * Write access to each collection is restricted to authorized users. Read
 * access varies by collection, with some being publicly readable and others
 * restricted.
 *
 * Data Structure:
 * - /serviceCategories: Stores service categories.
 * - /serviceCategories/{serviceCategoryId}/services: Stores services within a category.
 * - /projects: Stores project information.
 * - /jobPostings: Stores job postings.
 * - /jobPostings/{jobPostingId}/applications: Stores job applications.
 * - /contactFormSubmissions: Stores contact form submissions.
 *
 * Key Security Decisions:
 * - Public read access is enabled for 'serviceCategories', 'services', 'projects' and 'jobPostings' collections.
 * - Write access to all collections is restricted to prevent unauthorized modifications.
 * - Listing of subcollections is generally disallowed to prevent unintended data exposure.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isAdmin() {
      return request.auth != null; // For now, any logged in user is an admin.
    }

    /**
     * @description Allows anyone to read service categories, but restricts writing.
     * @path /serviceCategories
     * @allow (get, list): Any user can read service categories.
     * @deny (create, update, delete): No one can create, update, or delete service categories.
     * @principle Public read access with restricted writes.
     */
    match /serviceCategories/{serviceCategoryId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read services within a service category, but restricts writing.
     * @path /serviceCategories/{serviceCategoryId}/services
     * @allow (get, list): Any user can read services.
     * @deny (create, update, delete): No one can create, update, or delete services.
     * @principle Public read access with restricted writes.
     */
    match /serviceCategories/{serviceCategoryId}/services/{serviceId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read project information, but restricts writing.
     * @path /projects
     * @allow (get, list): Any user can read project information.
     * @deny (create, update, delete): No one can create, update, or delete projects.
     * @principle Public read access with restricted writes.
     */
    match /projects/{projectId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read job postings, but restricts writing.
     * @path /jobPostings
     * @allow (get, list): Any user can read job postings.
     * @deny (create, update, delete): No one can create, update, or delete job postings.
     * @principle Public read access with restricted writes.
     */
    match /jobPostings/{jobPostingId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to create an application. Only admins can read/list them.
     * @path /jobPostings/{jobPostingId}/applications
     * @principle Public create, restricted read/list.
     */
    match /jobPostings/{jobPostingId}/applications/{applicationId} {
      allow create: if true;
      allow get, list, update, delete: if isAdmin();
    }

    /**
     * @description Restricts access to contact form submissions, allowing no reads or writes.
     * @path /contactFormSubmissions
     * @deny (get, list, create, update, delete): No one can read or write contact form submissions.
     * @principle Strict denial of access.
     */
    match /contactFormSubmissions/{contactFormSubmissionId} {
      allow get, list, create, update, delete: if false;
    }

    // This rule allows collection group queries on the 'applications' collection.
    match /{path=**}/applications/{applicationId} {
        allow get, list: if isAdmin();
    }
  }
}
